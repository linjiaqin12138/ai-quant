# AI开发规范

## 代码风格与结构规范

### 1. 代码复用原则
- **优先使用项目现有的工具函数**：开发新功能时，首先检查`lib.utils`中是否已有相关工具函数
- **保持代码一致性**：遵循项目现有的代码风格和实现方案，参考同一文件夹下其他模块的代码
- **避免重复造轮子**：如使用`lib.utils.string.hash_str()`而不是重新实现哈希函数

### 2. 错误处理规范
- **透明错误处理**：不要随意捕获和隐藏异常，让错误"大大方方地抛出"，我们只在最外层进行try-catch
- **区分错误类型**：
  - 网络相关错误（ConnectionError, TimeoutError, OSError, RatelimitException）→ 使用重试机制
  - 其他错误 → 直接抛出，不要隐藏
- **使用装饰器处理重试**：使用`@with_retry`装饰器处理网络问题，而不是try-catch
- **记录重试日志**：使用项目统一的日志记录方式记录重试信息

### 3. 函数设计规范
- **单一职责原则**：每个函数应该只做一件事
- **明确的输入输出**：使用类型注解明确参数和返回值类型
- **合理的默认参数**：为可选参数提供合理的默认值
- **完整的文档字符串**：包含功能描述、参数说明、返回值说明和使用示例

### 4. Class的设计规范
- **类的职责单一**：每个类应该只负责一个功能模块

### 5. 日志打印规范：
- INFO日志要能够指示代码运行到那一步
- Warning日志要给用户一些不好的情况的提示，但不至于代码运行不下去的场景
- Error发生无法处理、运行不下去的错误，并打印堆栈和错误信息
- Debug日志要将具体参数信息打印出来，字典要做json格式化输出

### 其它
1. 不要使用`.get`方法访问字典中的值，除非有明确的默认值需求，而是直接访问字典Key
2. 字符串和字典键访问使用双引号，除非使用f-string嵌套表达式时，将字典键访问的部分用单引号包裹

## 项目结构规范

### 1. 目录结构规范
- `lib/utils/`: 通用工具函数，**不具有副作用**
- `lib/tools/`: 通用工具函数，**具有副作用**（如网络请求、文件操作）
- `lib/adapter/`: 适配器层，统一不同API或数据源的接口
- `lib/model/`: 数据结构和业务模型
- `lib/modules/`: 复杂功能模块，整合其他组件
- `test/`: pytest测试用例

### 2. 导入规范
- 按照层次结构导入：标准库 → 第三方库 → 项目内部模块
- 使用相对导入引用项目内部模块
- 导入项目工具函数时优先使用`lib.utils`中的函数

## 开发流程规范

### 1. 测试驱动开发
- **编写全面的测试用例**：包括正常流程、边界情况和异常情况
- **禁止“脱裤子放屁”式测试用例**：不要编写无实际意义、仅为测试覆盖而覆盖、对功能无实际验证价值的测试用例（如仅调用函数但不做断言、不验证结果的测试）。
    - 典型例子：
        - 仅调用函数但没有任何断言或结果校验的测试用例。
        - 测试内容与实际业务无关，仅为提高覆盖率而随意调用接口。
        - 对返回值不做任何检查，或者断言永远为真的表达式（如assert True）。
        - 测试用例内容与被测函数无实际关联，仅起到“走流程”作用。
- **测试覆盖率要求**：确保关键功能有充分的测试覆盖
- **集成测试**：验证实际的网络访问、数据库操作等
- **使用pytest标记**：区分单元测试、集成测试和慢速测试

### 2. 错误处理策略
- **网络相关错误**：使用重试机制，最大重试次数通常为3次
- **配置错误**：在启动时就检查并报告配置问题
- **数据格式错误**：提供清晰的错误信息，便于调试
- **日志记录**：使用`lib.logger`记录重要操作和错误信息

### 3. 代码审查要点
- **API兼容性**：关注第三方库的更新，及时修复弃用API
- **性能考虑**：避免不必要的重复计算和内存占用
- **安全考虑**：敏感信息不要硬编码，使用配置文件或环境变量
- **文档完整性**：确保关键函数有完整的文档字符串

## 临时测试与实验性代码管理规范

### 1. 临时测试脚本的存放位置
- **禁止将临时测试脚本放在 test/ 目录下**，test/ 目录仅用于 pytest 测试用例。
- 临时测试、调试、实验性脚本应统一放在 temp/ 目录下，并在 .gitignore 中标记为忽略。
- temp/ 目录用于存放临时文件、实验性代码、一次性脚本等，不参与正式测试和版本管理。

### 2. 导入模块错误的处理
- 临时脚本如需导入项目模块，需确保项目已通过 `pip install -e .` 方式安装为开发包，避免导入错误。
- 遇到导入错误时，优先检查 sys.path、项目结构和安装方式。

### 3. 经验教训
- 临时测试脚本与正式测试用例要严格分离，避免污染测试体系。
- 规范临时文件管理，便于团队协作和代码审查。
- 发现问题要及时总结到开发规范文档，持续改进开发流程。


## 其它：


---

*本规范会随着项目发展持续更新，请定期查阅最新版本*